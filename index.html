<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="carta-botao">
    <div id="margem">
      <div class="container">
        <div class="header">
          <div>
            <span id="nome"> Ash </span>
          </div>
          <div class="signo">
            <img src="./aries.png" id="img-signo">
          </div>
          <div class="pokemon">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" id='img-pokemon'>
          </div>
        </div>
        <div class="img">
          <img src="./ash.jpg" id="img-character">
        </div>
        <div class="atributos-div">
          <div class="atributos-items">
            <div class="atributos">
              <span class="calouro"> <strong>Pronomes:</strong> <span id="pronomes">Ele \ Dela </span></span>
              <span class="simples"> <strong>Apelido:</strong> <span id="apelido">Ashezinho </span></span>
              <span><strong>Pokemon:</strong> <span id="pokemon">Pikachu</span></span> 
            </div>
            <div class="atributos">
              <span> <strong>@twitter:</strong> <span id="twitter">@ash</span> </span>
              <span> <strong>HP:</strong> <span id="hp">52</span> </span>
            </div>
            <div class="atributos">
              <span> <strong>@instagram:</strong> <span id="instagram">Ash</span> </span>
              <span> <strong>Attack:</strong> <span id="attack">69</span> </span>
  
            </div>
            <div class="atributos">
              <span> <strong>Idade:</strong> <span id="idade">13 anos</span> </span>
              <span> <strong>Defense:</strong> <span id="defense">13</span> </span>
            </div>
            <hr>
            <div class="atributos-2">
              <span> <strong>Cidade:</strong> <span id="cidade">Pokelandia</span> </span>
              <span class="calouro"> <strong>Orientação Sexual:</strong> <span id="sexual">Nada a declarar</span> </span>
              <span class="calouro"> <strong>Orientação Política:</strong> <span id="politica">Escravidão de pokemon</span> </span>
              <span class="simples"> <strong>Profissão:</strong> <span id="profissao">Batalhador de pokemons</span> </span>
              <span> <strong>Hobbies:</strong> <span id="hobbies">Tacar o pikachu nos outros</span> </span>
              <span class="calouro"> <strong>Bebe:</strong> <span id="bebe">Agua que o pidgey não bebe</span> </span>
              <span class="calouro"> <strong>Usa quais drogas:</strong> <span id="drogas">Erva de gato</span> </span>
              <span> <strong>Animes preferidos:</strong> <span id="animes">Digimon</span> </span>
              <span> <strong>Status Relacionamento:</strong> <span id="relacionamento">Enrolado</span> </span>
              <hr>
              <span> <strong>Tipo do pokemon:</strong> <span id="tipos">Água</span> </span>
              <span> <strong>Habilidades do pokemon:</strong> <span id="habilidades">Dar choque nas pessoas</span> </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <a id="salvar" class="botao" src=""> Salvar </a>
    <button onclick="voltar()" class="voltar"> Voltar </button>
  </div>
  
  <div id="form-total">
    <div class="form">
      <div class="title">
        <h2> Descubra qual pokemon combina com seu nome </h2>
      </div>
     
      <div class="form-item">
        <label id="label-formulario">Formulário Calouro</label><button class="voltar" onclick="trocarFormulario()">Trocar Formulário</button>
      </div>
      <div class="form-item">
        <label>Nome:</label><input type="text" placeholder="Ash" name="nome">
      </div>
      <div class="form-item calouro">
        <label>Pronomes:</label><input type="text" placeholder="Ele / Dele" name="pronomes">
      </div>
      <div class="form-item simples">
        <label>Apelido:</label><input type="text" placeholder="Ashezinho" name="apelido">
      </div>
      <div class="form-item">
        <label>@twitter:</label><input type="text" placeholder="@ash_u_gostoso" name="twitter">
      </div>
      <div class="form-item">
        <label>@instagram:</label><input type="text" placeholder="@ash_u_gostoso_2015" name="instagram">
      </div>
      <div class="form-item">
        <label>Idade:</label><input type="text" placeholder="18" name="idade">
      </div>
      <div class="form-item simples">
        <label>Profissão:</label><input type="text" placeholder="Estudante / Programador" name="profissao">
      </div>
      <div class="form-item">
        <label>Cidade:</label><input type="text" placeholder="Pokelandia" name="cidade">
      </div>
      <div class="form-item calouro">
        <label>Orientação sexual:</label><input type="text" placeholder="Nada a declarar" name="sexual">
      </div>
      <div class="form-item calouro">
        <label>Orientação politica:</label><input type="text" placeholder="Poliglota" name="politica">
      </div>
      <div class="form-item">
        <label>Hobbies:</label><input type="text" placeholder="Taka o pikachu nos outros" name="hobbies">
      </div>
      <div class="form-item calouro">
        <label>Bebe:</label><input type="text" placeholder="Agua que o pidgey não bebe" name="bebe">
      </div>
      <div class="form-item calouro">
        <label>Usa quais drogas:</label><input type="text" placeholder="Erva de gato" name="drogas">
      </div>
      <div class="form-item">
        <label>Animes preferidos:</label><input type="text" placeholder="Digimon" name="animes">
      </div>
      <div class="form-item">
        <label>Relacionamento:</label><input type="text" placeholder="Enrolado" name="relacionamento">
      </div>
      <div class="form-item">
        <label>Signo:</label><select id='select-img-signo'>
            <option value="aries">Aries</option>
            <option value="touro">Touro</option>
            <option value="gemeos">Gemeos</option>
            <option value="cancer">Cancer</option>
            <option value="leao">Leao</option>
            <option value="virgem">Virgem</option>
            <option value="libra">Libra</option>
            <option value="escorpiao">Escorpiao</option>
            <option value="sagitario">Sagitario</option>
            <option value="capricornio">Capricornio</option>
            <option value="aquario">Aquario</option>
            <option value="peixes">Peixes</option>
          </select>
      </div>
        <label id="label-arquivo" for="arquivo">Sua Imagem:</label><input type="file" name='img-character' id="arquivo"> 
      <div class="social">
        <a href="https://www.instagram.com/pettersonk/" target="_blank"><img class="social-icon" src="./instagram.png"></a>
        <a href="https://www.linkedin.com/in/petterson-neves-62051a129/" target="_blank"><img class="social-icon" src="./linkedin.png"></a>
        <a href="https://github.com/PkNeves" target="_blank"><img class="social-icon" src="./github.png"></a>
      </div>
    </div>
    <button onclick="confirma()">Confirmar</button>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js"></script>

</body>
</html>

<script>
  let formulario = 'calouro'

  const signos = {
    "aries": {
      url: "./aries.png",
      color: "#F30D0D",
      complementar: "#01adff",
    },
    "touro": {
      url: "./touro.png",
      color: "#D879F2",
      complementar: "#91da97",
    },
    "gemeos": {
      url: "./gemeos.png",
      color: "#FFD93B",
      complementar: "#3be9ff",
    },
    "cancer": {
      url: "./cancer.png",
      color: "#FFFFFF",
      complementar: "fa7f72",
    },
    "leao": {
      url: "./leao.png",
      color: "#FF7A28",
    },
    "virgem": {
      url: "./virgem.png",
      color: "#80F74D",
      complementar: "#f08080",
    },
    "libra": {
      url: "./libra.png",
      color: "#FF81D0",
      complementar: "#81ffd8",
    },
    "escorpiao": {
      url: "./escorpiao.png",
      color: "#6C2A2C",
      complementar: "#9f6d6b"
    },
    "sagitario": {
      url: "./sagitario.png",
      color: "#3E0A52",
      complementar: "#b8860b"
    },
    "capricornio": {
      url: "./capricornio.png",
      color: "#020003",
      complementar: "#fffff0",
    },
    "aquario": {
      url: "./aquario.png",
      color: "#1561C9",
      complementar: "#c5de00"
    },
    "peixes": {
      url: "./peixes.png",
      color: "#6BA2F2",
      complementar: "#cfc48e"
    }
  }
  const ids = ['nome', 'img-signo', 'img-pokemon', 'img-character', 'pronome', 'twitter', 'instagram', 'idade', 'cidade', 'sexual', 'politica', 'hobbies', 'bebe', 'drogas', 'animes', 'relacionamento']
  
  function trocarFormulario() {
    if (formulario == 'simples') {
      formulario = 'calouro'
      let label = document.querySelector("#label-formulario").innerHTML = "Formulário Calouro"
      let camposSimples = document.querySelectorAll(".simples")
      let camposCalouros = document.querySelectorAll(".calouro")

      for (let i = 0; i<camposSimples.length; i++) {
        camposSimples[i].style.display = 'none';
      }
      for (let i = 0; i<camposCalouros.length; i++) {
        camposCalouros[i].style.display = 'block';
      }
    } else {
      formulario = 'simples'
      let label = document.querySelector("#label-formulario").innerHTML = "Formulário Simples"

      let camposSimples = document.querySelectorAll(".simples")
      let camposCalouros = document.querySelectorAll(".calouro")

      for (let i = 0; i<camposSimples.length; i++) {
        camposSimples[i].style.display = 'block';
      }
      for (let i = 0; i<camposCalouros.length; i++) {
        camposCalouros[i].style.display = 'none';
      }
    }
  }

  function poemDadosPokemon(dados) {
    if (dados.status != 200) return
    const name = dados.data.name
    const hp = dados.data.stats[0].base_stat
    const attack = dados.data.stats[1].base_stat
    const defense = dados.data.stats[2].base_stat
    const img = dados.data.sprites.other.dream_world.front_default
    const habilidades = dados.data.abilities
    const tipos = dados.data.types
    let habilidades_name = ''
    let tipos_name = ''

    for(let i=0; i<habilidades.length; i++) {
      habilidades_name += habilidades[i].ability.name + ' / '
    }
    for(let i=0; i<tipos.length; i++) {
      tipos_name += tipos[i].type.name + ' / '
    }

    const htmlName = document.querySelector('#pokemon').innerHTML = name
    const htmlHp = document.querySelector('#hp').innerHTML = hp
    const htmlAttack = document.querySelector('#attack').innerHTML = attack
    const htmlDefense = document.querySelector('#defense').innerHTML = defense
    const htmlImg = document.querySelector('#img-pokemon').src = img
    const htmlHabilidades = document.querySelector('#habilidades').innerHTML = habilidades_name
    const htmlTipos = document.querySelector('#tipos').innerHTML = tipos_name
  }

  async function pegaDadosPokemon(nome) {
    nome = nome.toLowerCase()
    nome = nome.replace(/\s/g, '')
    let count = 0
    for (let i = 0; i<nome.length; i++) {
      count += nome.charCodeAt(i)
    }
    let pokemonNumber = count % 151

    let data = await axios.get(`https://pokeapi.co/api/v2/pokemon/${pokemonNumber}`)
    poemDadosPokemon(data)
    }

  function putImage(name) {
    let output = document.querySelector(`#${name}`);
    let event = document.querySelector(`input[name=${name}]`)
    output.src = URL.createObjectURL(event.files[0]);
    // output.onload = function() {
    //   URL.revokeObjectURL(output.src) // free memory
  // };
  }

  async function confirma() {
    let cartaBotao = document.querySelector("#carta-botao")
    let margem = document.querySelector("#margem")
    let atributos = document.querySelectorAll(".atributos")
    let form = document.querySelector("#form-total")
    let inputs = form.querySelectorAll('input')
    let principalNome = '';

    // put signo image
    let select = form.querySelector("#select-img-signo")
    let signo = select.value;
    if (signo != '') {
      let imgSigno = document.querySelector('#img-signo')
      imgSigno.src = signos[signo].url
    }
    
    for (let i=0; i<inputs.length; i++) {
      let campo = inputs[i].name
      // put character image
      if (campo === 'img-character') {
        if (inputs[i].files.length > 0) {
          putImage('img-character')
        }
        continue
      }
      if (campo == 'nome') {
        principalNome = inputs[i].value == '' ? "Ash" : inputs[i].value
        inputs[i].value = principalNome
      } else {
        inputs[i].value = inputs[i].value == '' ? "-" : inputs[i].value
      }
      // put other fields
      let span = document.querySelector(`#${inputs[i].name}`)
      span.innerHTML = inputs[i].value

      // var node = document.getElementById('margem');

    
    }

    await pegaDadosPokemon(principalNome)
    

    for (let i =0; i<atributos.length; i++) {
      atributos[i].style.backgroundColor = signos[signo].complementar
    }

    // alter visualization
    form.style.display = 'none'
    cartaBotao.style.display = 'flex'
    margem.style.backgroundColor = signos[signo].color

    domtoimage.toPng(margem)
    .then(function (dataUrl) {
        let link = document.querySelector("#salvar")
        // var link=window.URL.createObjectURL(blob);
        // window.location=link;
        // var link = document.createElement('a');
        link.download = 'my-card-pokemon.png';
        link.href = dataUrl;

        // link.click();
        // link.remove();
  });
  }

//   function salvar() {
//     var node = document.getElementById('margem');

//     domtoimage.toPng(node)
//     .then(function (dataUrl) {
//         // var link=window.URL.createObjectURL(blob);
//         // window.location=link;
//         var link = document.createElement('a');
//         link.download = 'my-card-pokemon.png';
//         link.href = dataUrl;
//         link.click();
//         link.remove();
//   });
// }
function voltar() {
    let cartaBotao = document.querySelector("#carta-botao")
    let form = document.querySelector("#form-total")
    form.style.display = 'flex'
    cartaBotao.style.display = 'none'
  }
</script>

<style>

.botao {
  text-align: center;
  padding: 4px 10px;
  background-color: #3FDF3F;
  margin: 5px;
  border: 2px solid black;
  border-radius: 10px;
}

.botao:hover {
  background-color: #3abb3a;
}

.simples {
  display: none;
}

@font-face {
    font-family: 'pokemon';
    src: url('./PokemonSolid.ttf');
}

.title {
  display: flex;
  align-items: center;
  justify-content: center;
  justify-items: center;
}

h2 {
  font-family: pokemon;
  margin-left: 40px;
  text-shadow: 1px 1px 2px rgb(204, 191, 133);
  color: rgb(6, 46, 179);
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  margin: 0;
  padding: 0;
}

#carta-botao {
  display: none;
  flex-direction: column;
  min-width: 400px;
  max-width: 400px;
}

#margem {
  box-sizing: border-box;
  margin: 0;
  position: relative;
  border: 7px solid #FEE064;
  min-width: 400px;
  max-width: 400px;
  border-radius: 5px;
  background-color: #D75A95;
  box-shadow: inset 1px 1px 130px black;

}

.container {
  padding: 10px 20px;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-content: start;
  align-items: center;
}

.header {
  width: 100%;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
}

.header > div > span {
  font-size: 2em;
  color: white;
}

.signo {
  position: absolute;
  top: 30px;
  right: 13px;
  width: 30px;
  height: 30px;
  border: 3px solid grey;
  border-radius: 50%;
  background-color: white;
  padding: 3px;
}

.signo > img {
  width: 100%;
  height: 100%;
}

.pokemon {
  padding-right: 15px;
  width: 40px;
  height: 45px;
  position: absolute;
  top: 210px;
  right: 45px;
}

.pokemon > img {
  width: 100px;
  height: 100px;
}



.img {
  padding: 0;
  margin: 0;
  border: 5px solid grey;
  background-color: white;
  height: 250px;
  width: 100%;
}

.img img {
  padding: 0;
  margin: 0;
  width: 100%;
  height: 250px;
  object-fit: cover;
  object-position: 50% 45%;
}

.atributos-div {
  margin: 20px 0;
  width: 100%;
}

.atributos-items {
  display: flex;
  flex-direction: column;
}

.atributos {
  padding: 4px 10px;
  margin: 2px;
  background-color: #FEE064;
  display: flex;
  align-items: start;
  justify-content: space-between;
  border-radius: 4px;
  box-shadow: inset 0 0 15px black;
}

.atributos-2 {
  width: 93%;
  padding: 10px 10px;
  margin: 2px;
  background-color: #f0f0f0;
  display: flex;
  flex-direction: column;
  align-items: start;
  justify-content: space-between;
  border-radius: 4px;
  box-shadow: inset 0 0 15px black;
}

#form-total {
  min-width: 400px;
  max-width: 400px;
  display: flex;
  flex-direction: column;
}

.form {
  padding: 10px;
  display: flex;
  flex-direction: column;
  border: 1px solid black;
  align-items: end;
  box-sizing: border-box;
  margin: 0;
  position: relative;
  border: 7px solid #FEE064;
  min-width: 400px;
  max-width: 400px;
  border-radius: 5px;
  background-color: #D75A95;
  box-shadow: inset 1px 1px 130px black;
}

.social {
  padding-top: 10px;
  width: 100%;
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.social-icon {
  width: 30px;
  height: 30px;
}

input , select {
  margin: 5px;
  border-radius: 10px;
  padding: 3px 10px;
}

input::placeholder {
  opacity: 0.5;
}

input[type="file"] {
    display: none;
}

#label-arquivo {
    margin: 10px;
    padding: 10px 10px;
    width: 90%;
    background-color: #FEE064;
    text-transform: uppercase;
    text-align: center;
    display: block;
    margin-top: 10px;
    cursor: pointer;
    border-radius: 5px;
  }
#label-arquivo:hover {
  background-color: #cfb54a;
    
}


label {
  font-weight: 900;
}

select {
  width: 185px;
}

button {
  background-color: rgba(32, 218, 32, 0.863);
  border-radius: 10px;
  padding: 5px 10px;
  margin: 5px;
  font-weight: 600;
  cursor: pointer;
}

button:hover {
  background-color: rgba(38, 168, 38, 0.863);
}

hr {
  width: 100%;
}

.voltar {
  background-color: #FEE064;
}

.voltar:hover {
  background-color: #ddc04a;
}

a, a:hover, a:focus, a:active {
      text-decoration: none;
      color: inherit;
      color: black;
      font-weight: 600;
      font-size: 0.9em;
 }
</style>

